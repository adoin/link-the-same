# 开发指南

## 已完成的功能 ✅

### 1. 项目基础架构
- ✅ TypeScript + SASS 配置
- ✅ 项目结构规划
- ✅ 类型定义（`typings/game.d.ts`）
- ✅ 常量配置（`utils/constants.ts`）

### 2. 核心游戏逻辑（`utils/game-logic.ts`）
- ✅ **棋盘生成算法**：根据 `MULTIPLE_NUMBER` 生成指定倍数的棋子
- ✅ **路径查找算法**：支持直线、一个转角、两个转角的连接
- ✅ **消除逻辑**：匹配和移除方块
- ✅ **提示功能**：查找可消除的一对方块
- ✅ **重排功能**：打乱棋盘（使用 `DISRUPT_TIMES` 控制次数）
- ✅ **游戏状态检测**：检查游戏是否结束、是否还有可消除对

### 3. 游戏组件
- ✅ **GameTile 组件**：单个游戏方块
  - 显示图标
  - 选中状态
  - 消除动画
  
- ✅ **GameBoard 组件**：游戏棋盘
  - 棋盘渲染
  - 点击交互
  - 计时器
  - 分数系统
  - 连击系统
  - 提示和重排功能

### 4. 游戏页面
- ✅ **开始界面**：
  - 游戏标题
  - 难度选择（简单/中等/困难）
  - 开始游戏按钮
  - 游戏规则说明
  
- ✅ **游戏界面**：
  - 游戏信息栏（分数、时间、连击）
  - 操作按钮（提示、重排、暂停）
  - 游戏棋盘
  
- ✅ **暂停界面**：
  - 继续游戏
  - 重新开始
  - 退出游戏
  
- ✅ **游戏结束界面**：
  - 显示胜利/失败
  - 显示最终得分
  - 再来一局
  - 返回首页

## 待完善的功能 📝

### 1. 图标资源
- ⏳ 需要准备 30 个游戏图标（PNG 格式）
- ⏳ 放置在 `miniprogram/images/icons/` 目录
- ⏳ 命名为 `icon-1.png` 到 `icon-30.png`

### 2. 路径动画
- ⏳ 使用 Canvas 绘制连线路径
- ⏳ 路径动画效果

### 3. 音效
- ⏳ 点击音效
- ⏳ 消除音效
- ⏳ 胜利/失败音效
- ⏳ 背景音乐

### 4. 数据持久化
- ⏳ 保存最高分
- ⏳ 保存游戏统计
- ⏳ 排行榜功能

### 5. 性能优化
- ⏳ 图片预加载
- ⏳ 动画性能优化
- ⏳ 减少 setData 调用

## 如何开始测试

### 1. 准备图标资源

**方案 A：使用临时占位符**

创建简单的彩色方块作为临时图标：
```javascript
// 可以使用 Canvas 生成临时图标
// 或者使用纯色背景 + 数字文字
```

**方案 B：下载免费图标**

从以下网站下载图标：
- [iconfont](https://www.iconfont.cn/)
- [Flaticon](https://www.flaticon.com/)
- [Icons8](https://icons8.com/)

### 2. 在微信开发者工具中打开项目

1. 打开微信开发者工具
2. 导入项目，选择项目根目录
3. 确保 `project.config.json` 中的 `miniprogramRoot` 设置为 `miniprogram/`

### 3. 开始测试

1. 点击"开始游戏"按钮
2. 选择难度
3. 开始游戏
4. 测试各种功能：
   - 点击方块进行消除
   - 使用提示功能
   - 使用重排功能
   - 暂停/继续游戏
   - 测试游戏胜利/失败流程

## 常量配置说明

### `MULTIPLE_NUMBER`（棋子倍数）

控制每种图标生成多少对。

```typescript
export const MULTIPLE_NUMBER = 2
```

- 值为 2：每种图标生成 2 对（4 个）
- 值为 3：每种图标生成 3 对（6 个）
- 建议值：2-3

### `DISRUPT_TIMES`（打乱次数）

控制棋盘生成时打乱的次数，增加随机性。

```typescript
export const DISRUPT_TIMES = 3
```

- 值越大：棋盘越随机
- 建议值：3-5

### 难度配置

在 `constants.ts` 中可以调整各难度的参数：

```typescript
export const DIFFICULTY_CONFIGS = {
  easy: {
    rows: 6,        // 行数
    cols: 8,        // 列数
    iconTypes: 12,  // 图标种类
    timeLimit: 300, // 时间限制（秒）
  },
  // ...
}
```

## 调试技巧

### 1. 查看棋盘状态

在 `game-board.ts` 中添加日志：
```typescript
console.log('Board:', this.data.board)
```

### 2. 测试路径查找

在 `game-logic.ts` 中测试：
```typescript
const path = findPath(board, tile1, tile2)
console.log('Path:', path)
```

### 3. 调整游戏速度

修改 `constants.ts` 中的动画时间：
```typescript
export const ANIMATION_DURATION = {
  SELECT: 200,   // 减小值可以加快速度
  PATH: 300,
  REMOVE: 400,
  // ...
}
```

## 已知问题

1. **路径绘制未实现**：Canvas 绘制路径功能待完善
2. **图标资源缺失**：需要准备实际的图标图片
3. **音效未添加**：需要添加音效文件和播放逻辑

## 下一步开发建议

### 优先级 P0（必须完成）
1. 准备游戏图标资源
2. 测试游戏核心流程
3. 修复发现的 Bug

### 优先级 P1（重要）
1. 实现路径连线动画
2. 添加音效
3. 优化动画效果

### 优先级 P2（可选）
1. 数据持久化
2. 排行榜功能
3. 更多难度等级
4. 皮肤主题切换

## 技术要点

### 1. 路径查找算法

支持三种连接方式：
- **直线**：同行或同列，中间无障碍
- **一个转角**：通过一个转角点连接
- **两个转角**：通过两个转角点连接

### 2. 棋盘生成

确保生成的棋盘：
- 所有图标成对出现
- 经过多次打乱增加随机性
- 保证有可消除的对

### 3. 游戏状态管理

使用 `GameStatus` 类型管理游戏状态：
- `ready`：准备开始
- `playing`：游戏中
- `paused`：暂停
- `won`：胜利
- `lost`：失败

## 贡献指南

欢迎提交 Issue 和 Pull Request！

在提交代码前请确保：
1. 代码通过 TypeScript 类型检查
2. 遵循项目的代码风格
3. 添加必要的注释
4. 测试功能正常

## License

MIT

